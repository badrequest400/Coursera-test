<!DOCTYPE html>
<html lang="en">
<head>
  <title>Snake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">   
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
</head>
<body>
<style>
  html{
    --color-bg-1: #BCE8F0;
    --color-bg-2: #9BDCE9;
    --color-border-1: #4F8492;
    --color-border-2: #022B3A;
    --color-item-1: #6DA2B0;
    --color-text-1: #022B3A;
    --color-text-2: #044962;
    --color-text-3: #6DA2B0;
  }
  body{
    box-sizing: border-box;
    background-color: var(--color-bg-2);
  	color: var(--color-text-1);
    font-size: 15px;
  	font-family: Verdana, sans-serif;    
  }
  h1{
    border-bottom: 3px solid var(--color-border-1);
    color: var(--color-text-1);
    font-weight: bold;
    letter-spacing: 2px;
    margin-bottom: 30px;
    padding: 10px;
    text-align: center;
  }
  #description{
    margin-bottom: 40px;
  }
  p{
    line-height: 120%;
    text-align: justify;
  }
  .box-n-btn{
    border: 2px solid var(--color-border-1);
    border-radius: 10px;
    padding: 4px 9px 4px 9px;
  }
  .text-box{
    border: 10px solid var(--color-border-1);
    border-radius: 10px;
    background-color: var(--color-bg-1);
    color: var(--color-text-2);
    font-size: 0.8em;
    font-family: Verdana, sans-serif;
    overflow: auto;
    padding: -10px;
    /*padding: 4px 9px 4px 9px;*/
    resize: none;
    margin-bottom: 40px;
  }
  .text-box:focus{
    border-color: var(--color-border-1);
    box-shadow: 0px 0px 0px 0px #000;
  }
  .text-box::placeholder{
    color: var(--color-text-3);
  }
  .text-box:focus::placeholder{
    color: var(--color-text-3);
  }
  .function-button{
    background-color: var(--color-border-1);
    color: white;
    font-size: 1.2em;
    font-weight: bold;
    height: 40px;
    letter-spacing: 2px;
    margin-top: 10px;
  }
  .function-button:active{
    background-color: var(--color-item-1);
    border: 2px solid var(--color-item-1);
  }
</style>

<div id = "main-content" class = "container">
  <div class = "row">
    <h1 class = "col-sm-12">Snake</h1>
    <div id = "description" class = "col-sm-10 col-sm-offset-1">
      <p>A classic game of snake. Use the W, S, A, D keys to control the snake.</p>
      <p>Score: <span id="sc">0</p>
    </div>
  </div>

  <div class = "row">
    <div class = "col-sm-12">
      <label>Canvas</label>
      <div class = "clearfix"></div>
      <canvas id = "canvas-box" class = "text-box" width = "1120" height = "440"></canvas>
    </div>

    <div class = "col-sm-12">
      <button type = "button" class = "box-n-btn function-button btn-block col-sm-12" onclick = "snakeGame()">start</button>
    </div>
    <!-- <div class = "col-sm-12">
      <button type = "button" class = "box-n-btn function-button btn-block col-sm-12" onclick = "snakeGame(1)">stop</button>
    </div> -->

  </div>
</div>

<script>  
  function snakeGame(){    
    var canvas = document.getElementById("canvas-box");
    var ctx = canvas.getContext("2d");
    var ups = 20; // upscale level 
    var cnvrgt = 1120 / ups; // canvas bottom
    var cnvbtm = 440 / ups; // canvas right

    var onecyc = 5; // length of one cycle - to adjust speed of game. Min 2
    var t = 0; // timer
    var prev_t = t;
    var dirx = 0, diry = 1; // direction of snake movement
    var prev_dirx = -1, prev_diry = 0; // direction of snake movement in the previous cycle
    var snhx = 5, snhy = 5; // position of the head of the snake
    var snx = [5,6,7,8,8,8,9,10]; // initial snake position
    var sny = [5,5,5,5,4,3,3,3]; // initial snake position
    var growth = 0;
    var aplx = 12;
    var aply = 12;
    var appleFlag = false;
    var score = 0;

    drawWall(cnvrgt, cnvbtm);
    

    var timer = setInterval(mainFn, 10);

    function mainFn(){    
      document.addEventListener('keydown', reactToKey);
         
      if (t < onecyc){
        t = t + 1;
      } else {
        snhx = snhx + dirx;
        snhy = snhy + diry;
        check180turn();
        checkHitSn();
        checkWall();
        checkApple();
        updateSn();
        drawSn();
        drawRedSq(aplx, aply);   
        t = 0;
      }
    };

    // Functions to invoke
    function reactToKey(k){
      prev_dirx = dirx;
      prev_diry = diry;

      if (k.code == 'KeyW') { // move up
        dirx = 0;
        diry = -1;
      }
      if (k.code == 'KeyS') { // move down
        dirx = 0;
        diry = 1;
      }
      if (k.code == 'KeyA') { // move left
        dirx = -1;
        diry = 0;
      }
      if (k.code == 'KeyD') { // move right
        dirx = 1;
        diry = 0;
      }
      if (k.code == 'KeyG') { // grow snake SHOULD BE REMOVED FROM FINAL
        growth = 3;
      }
      if (k.code == 'KeyF') { // place new apple
        newApple();
      }


      if (prev_dirx != dirx && prev_diry != diry){
        t = onecyc;
      } else {
        console.log("forced forward"); // it also activates if g or f is pressed
      }
        
    };
    function checkHitSn(){
      let i = 0;
      for (i = 0; i < snx.length; i++){
        if (snhx == snx[i] && snhy == sny[i]){
          clearInterval(timer);
          alert("Game Over! Snake bit self");
        }
      };
    };
    function checkWall(){
      if (snhx == 0 || snhx == cnvrgt-1){
        clearInterval(timer);
        alert("Game Over! Wall hit!");
      }
      if (snhy == 0 || snhy == cnvbtm-1){
        clearInterval(timer);
        alert("Game Over! Wall hit!");
      }
    };
    function checkApple(){
      if (snhx == aplx && snhy == aply){
        console.log("apple eaten");
        growth = 3;
        score++;
        document.getElementById('sc').innerHTML = score;
        newApple();        
      }
    };
    function check180turn(){
      if(snhx == snx[1] && snhy == sny[1]){
        snhx = snhx - 2 * dirx;
        snhy = snhy - 2 * diry;
      } 
    };  
    function updateSn(){
      if (growth > 0){
        snx.unshift(snhx);
        sny.unshift(snhy);
        growth--;
      } else {
        snx.pop();
        sny.pop();
        snx.unshift(snhx);
        sny.unshift(snhy);
      }
    };
    function drawSn(){    
      let i = 0;
      clearBg(cnvrgt, cnvbtm);
      for (i = 0; i < snx.length; i++){
        drawSq(snx[i], sny[i]);
      };
        // drawRedSq(snx[2], sny[2]);
    };
    function drawSq(a, b){
      let x = a * ups;
      let y = b * ups;
      ctx.fillStyle = "#4F8492";
      ctx.fillRect(x, y, ups, ups);
    };
    function drawRedSq(a, b){
      let x = a * ups;
      let y = b * ups;
      ctx.fillStyle = "#FF0000";
      ctx.fillRect(x, y, ups, ups);
    };
    function drawWall(w, h){
      let i = 0;

      for (i = 0; i < w; i++) { // draw top and bottom wall
        drawSq(i, 0);
        drawSq(i, h - 1);  // Without -1 the top right pixel of the square would be on edge of canvas therefore square would be off canvas
      }
      for (i = 0; i < h; i++) { // draw left and right wall
        drawSq(0, i);
        drawSq(w-1, i); 
      }
    };
    function newApple(){
      let cond1 = 0;
      let condexit = 0;
      let i = 0;

      do {
        cond1 = 0;      
        aplx = Math.floor(Math.random() * (cnvrgt - 2)) + 1;
        aply = Math.floor(Math.random() * (cnvbtm - 2)) + 1;
        for (i = 0; i < snx.length; i++){
          if (aplx == snx[i] && aply == sny[i]){
            console.log("The apple spawned on the snake");
            cond1 == 1;
          }
        }
        condexit++;
        if (condexit > 100){
          clearInterval(timer);
          break;
        }
      }
      while(cond1 == 1);
    }
    function clearBg(w, h){ // Screen should be cleared before every new drawSn(). Input: width and height in pixels
      ctx.clearRect(0 + ups, 0 + ups, (w - 2) * ups, (h - 2) * ups); // -1 * ups is the wall which should not be cleared
    };
  };

</script>
</body>
</html>

<!-- browser-sync start --server --directory --files "**/*" -->
<!-- https://coolors.co/022b3a-044962-4f8492-6da2b0-218397-9bdce9-bce8f0 -->